# firestore.md

## ğŸ“‚ Firestore ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã€Firebase Firestore ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®SNSé€£æºãƒ»é…ä¿¡è¨­å®šãƒ»ãƒ­ã‚°æƒ…å ±ãªã©ã‚’ä¿å­˜ãƒ»ç®¡ç†ã™ã‚‹ã€‚

ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® `uid` ã‚’ãƒ«ãƒ¼ãƒˆã¨ã—ã¦æ§‹æˆã•ã‚Œã‚‹ã€‚

```plaintext
/users/{uid}/...
```

---

## ğŸ”‘ ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§ï¼ˆæ§‹é€ ï¼‰

### 1. users/{uid}/accounts
SNSã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ¥ç¶šæƒ…å ±ï¼ˆOAuthãƒˆãƒ¼ã‚¯ãƒ³ãƒ»è­˜åˆ¥æƒ…å ±ï¼‰
```json
{
  "sns_type": "x",  // x | instagram | threads | tiktok
  "account_id": "1234567890",
  "screen_name": "@example",
  "access_token": "...",
  "refresh_token": "...",
  "connected_at": "2025-06-20T12:34:56Z"
}
```

---

### 2. users/{uid}/hashtags
ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°é…ä¿¡è¨­å®šï¼ˆX ã®ã¿å¯¾å¿œï¼‰
```json
{
  "sns_type": "x", // ç¾æ™‚ç‚¹ã§ã¯ x ã®ã¿
  "account_id": "1234567890",
  "hashtag": "#å¤ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ",
  "created_at": "2025-06-20T13:00:00Z",
  "enabled": true
}
```

---

### 3. users/{uid}/tweets
ãƒªãƒ—ãƒ©ã‚¤ç›£è¦–å¯¾è±¡ã®æŠ•ç¨¿IDï¼ˆX ã®ã¿å¯¾å¿œï¼‰
```json
{
  "sns_type": "x",
  "account_id": "1234567890",
  "tweet_id": "987654321",
  "created_at": "2025-06-20T13:30:00Z",
  "enabled": true
}
```

---

### 4. users/{uid}/dm_logs
è‡ªå‹•DMã®é…ä¿¡ãƒ­ã‚°
```json
{
  "sns_type": "x",
  "account_id": "1234567890",
  "recipient_user_id": "567890123",
  "dm_type": "hashtag" | "reply",
  "source_id": "#å¤ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ" | "987654321",
  "sent_at": "2025-06-20T14:00:00Z",
  "status": "success" | "failed",
  "error_message": null
}
```

---

## ğŸ›¡ï¸ ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

- ã™ã¹ã¦ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¯ `users/{uid}/...` ã®æ§‹æˆã«ã—ã€Firebase Authentication ã® `uid` ã¨ä¸€è‡´ã—ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯æ‹’å¦
- Firestore ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã§ `request.auth.uid == uid` ã®æ¡ä»¶ã‚’å³å¯†ã«è¨­å®šã™ã‚‹

---

## ğŸ”„ ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

- DMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½ï¼ˆusers/{uid}/dm_templatesï¼‰
- æŠ•ç¨¿æ¯ã®è¿”ä¿¡ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­å®šï¼ˆusers/{uid}/reply_templatesï¼‰
- ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹é›†è¨ˆãƒ“ãƒ¥ãƒ¼ï¼ˆåˆ¥é€”é›†è¨ˆç”¨ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ ï¼‰

